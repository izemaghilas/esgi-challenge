name: app
type: 'php:8.2'

dependencies:
  php:
    composer/composer: '^2'

runtime:
  extensions:
    - pdo_pgsql
    - sodium

variables:
  php:
    opcache.preload: api/config/preload.php

build:
  flavor: none

relationships:
  database: "db:postgresql"

mounts:
  'api/var': { source: local, source_path: var }

# The size of the persistent disk of the application (in MB).
disk: 2048

web:
  locations: 
    '/': 
      root: "api/public"
      passthru: "/index.php"
      allow: true

hooks:
    build: |
      set -x -e
      cd api
      curl -fs https://get.symfony.com/cloud/configurator | bash
      symfony-build
      php bin/console lexik:jwt:generate-keypair
    deploy: |
      set -x -e
      cd api
      symfony-deploy